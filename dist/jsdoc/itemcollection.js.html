<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: itemcollection.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: itemcollection.js</h1>

    


    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>var _ = require("lodash");
var services = require("./services");
var binder = require("./events").binder;
var DecksEvent = require("./events").DecksEvent;
var Item = require("./item");

/**
 * Represents a collection of Items
 *
 * @constructor
 * @mixes binder
 * @param {(Item[]|Object[])} items items with which to initialize collection
 */
function ItemCollection(items) {
  if (!(this instanceof ItemCollection)) { return new ItemCollection(items); }
  items = items || [];

  this._items = {};
  this.addItems(items);
}

_.extend(ItemCollection.prototype, binder, /** @lends ItemCollection.prototype */ {
  /**
   * Gets a single item from the collection
   *
   * @param {String} id Item id to find
   * @return {Item} Item or null if not found
   */
  getItem: function(id) {
    if (_.isNumber(id)) {
      id = "" + id;
    }
    return this._items[id];
  },

  /**
   * Gets multiple items from the collection
   *
   * @return {Item[]} array of items (not a collection instance)
   */
  getItems: function() {
    return _.values(this._items);
  },

  /**
   * Adds an item to the collection
   *
   * @param {(Item|Object)} item item to add
   * @param {?Object} options additional options
   * @return {undefined}
   */
  addItem: function(item, options) {
    if (!item) { throw new Error("item is required"); }
    options = options || {};

    if (!(item instanceof Item)) {
      item = new Item(item);
    }

    if (this._items[item.id]) { throw new Error("collection already contains an item with id " + item.id); }

    this._items[item.id] = item;

    if (!options.silent) {
      services.emitter.emit(DecksEvent("item:collection:item:added", this, item));
    }

    if (!options.noIndex) {
      this.index();
    }
  },

  /**
   * Adds an array of items to the collection
   *
   * @param {(Item[]|Object[])} items items to add
   * @param {?Object} options additional options
   * @return {undefined}
   */
  addItems: function(items, options) {
    if (!_.isArray(items)) { throw new Error("items are required"); }
    options = options || {};

    if (_.isEmpty(items)) { return; }

    _.each(items, function(item) {
      this.addItem(item, { noIndex: true });
    }, this);

    if (!options.silent) {
      services.emitter.emit("item:collection:items:added");
    }

    if (!options.noIndex) {
      this.index();
    }
  },

  /**
   * Removes an item from the collection
   *
   * @param {Item} item item to remove
   * @param {?Object} options additional options
   * @return {undefined}
   */
  removeItem: function(item, options) {
    if (!item) { throw new Error("item is required"); }
    options = options || {};

    if (!_.has(this._items, item.id)) {
      return;
    }

    delete this._items[item.id];

    if (!options.silent) {
      services.emitter.emit(DecksEvent("item:collection:item:removed", this, item));
    }

    if (!options.noIndex) {
      this.index();
    }
  },

  /**
   * Clears the collection
   *
   * @param {?Object} options additional options
   * @return {undefined}
   */
  clear: function(options) {
    options = options || {};

    if (_.isEqual(this._items, {})) { return; }

    _.each(this._items, function(item) {
      this.removeItem(item, { noIndex: true });
    }, this);

    // No need to re-index the collection, because it's now empty

    if (!options.silent) {
      services.emitter.emit(DecksEvent("item:collection:cleared", this));
    }
  },

  setFilter: function(filter, options) {
    options = options || {};

    if (this.filter === filter) { return; }

    this.filter = filter;

    if (!options.silent) {
      services.emitter.emit(DecksEvent("item:collection:filter:changed", this, this.filter));
    }

    if (!options.noIndex) {
      this.index();
    }
  },

  setSortBy: function(sortBy, options) {
    options = options || {};

    if (this.sortBy === sortBy) { return; }

    this.sortBy = sortBy;

    if (!options.silent) {
      services.emitter.emit(DecksEvent("item:collection:sortBy:changed", this, this.sortBy));
    }

    if (!options.noIndex) {
      this.index();
    }
  },

  setReversed: function(isReversed, options) {
    options = options || {};

    if (this.isReversed === isReversed) { return; }

    this.isReversed = isReversed;

    if (!options.silent) {
      services.emitter.emit(DecksEvent("item:collection:isReversed:changed", this, this.isReversed));
    }

    if (!options.noIndex) {
      this.index();
    }
  },

  index: function() {
    // Create a list of filtered, sorted, and reversed items, then find the index of each item
    // in the reference list.  If the item is not in the ref list, it will get an index of -1,
    // which means it should not be drawn (or should be hidden).

    var referenceItems = _(this.getItems());
    if (this.filter) {
      referenceItems = referenceItems.filter(this.filter);
    }
    if (this.sortBy) {
      referenceItems = referenceItems.sortBy(this.sortBy);
    }
    if (this.isReversed) {
      referenceItems = referenceItems.reverse();
    }
    referenceItems = referenceItems.value();

    var items = this.getItems();
    _.each(items, function(item) {
      var index = _.indexOf(referenceItems, item);
      item.setIndex(index);
    });

    services.emitter.emit(DecksEvent("item:collection:indexed", this));
  }
});

module.exports = ItemCollection;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Classes</h3><ul><li><a href="BasicGridLayout.html">BasicGridLayout</a></li><li><a href="BasicStackLayout.html">BasicStackLayout</a></li><li><a href="Canvas.html">Canvas</a></li><li><a href="Deck.html">Deck</a></li><li><a href="DecksEvent.html">DecksEvent</a></li><li><a href="Emitter.html">Emitter</a></li><li><a href="Frame.html">Frame</a></li><li><a href="GestureEmitter.html">GestureEmitter</a></li><li><a href="Item.html">Item</a></li><li><a href="ItemCollection.html">ItemCollection</a></li><li><a href="Layout.html">Layout</a></li><li><a href="Viewport.html">Viewport</a></li></ul><h3>Mixins</h3><ul><li><a href="binder.html">binder</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha5</a> on Thu Oct 16 2014 10:59:12 GMT-0600 (MDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
